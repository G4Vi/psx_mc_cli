#!/usr/bin/perl
use strict; use warnings;
use FindBin;
use lib "$FindBin::Bin/../lib";
use PSX::MC;
(@ARGV >= 1) or die("No mcd provided");

# load the memory card
my $file = $ARGV[0];
my $mcfile = PSX::MC->load($file);
if(!$mcfile) {
	die("Failed to open $file");
}
elsif($mcfile->{'type'} ne 'mcd') {
	die("Unsupported input format");
}

my $searchfname = $ARGV[1];
$mcfile->foreachDirEntry(sub {
	my ($entry, $newsave, $entrydata) = @_;
	return if(! $newsave);
	if(!$searchfname || ($newsave->{'filename'} eq $searchfname)) {
		my $mcs = $entrydata . $newsave->{'data'};
		print $mcs;
		exit 0;	
	}
});	
warn "Failed to extract save";
exit 1;
